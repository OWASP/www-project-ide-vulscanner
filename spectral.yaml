extends: ["spectral:oas", "spectral:asyncapi"]

rules:
  avoid-inline-scripts:
    description: "Avoid inline scripts to prevent XSS attacks."
    given: "$..script"
    severity: "error"
    then:
      function: pattern
      functionOptions:
        notMatch: ".*"
    message: "Use external JavaScript files instead of inline scripts."
    x-fix: "Remove the <script> tag and move the script to an external file."

  avoid-eval:
    description: "Use of 'eval()' can lead to code injection vulnerabilities."
    given: "$..['x-eval', 'eval']"
    severity: "error"
    then:
      function: truthy
    message: "Avoid using eval(). Use safer alternatives such as JSON.parse."
    x-fix: "Refactor code to remove eval()."

  enforce-https:
    description: "APIs should enforce HTTPS."
    given: "$.servers[*].url"
    severity: "error"
    then:
      function: pattern
      functionOptions:
        match: "^https://"
    message: "Use HTTPS instead of HTTP."
    x-fix: "Update API URLs to start with 'https://'."
