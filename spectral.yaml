extends: ["spectral:oas", "spectral:asyncapi"]

rules:
  avoid-inline-scripts:
    description: "Avoid inline scripts to prevent XSS attacks."
    given: "$..script"
    severity: "error"
    then:
      function: pattern
      functionOptions:
        notMatch: ".*"

  avoid-eval:
    description: "Use of 'eval()' can lead to code injection vulnerabilities."
    given: "$..['x-eval', 'eval']"
    severity: "error"
    then:
      function: truthy

  no-hardcoded-secrets:
    description: "Avoid hardcoded secrets in API specifications."
    given: "$..securityDefinitions..['apiKey', 'clientSecret', 'password']"
    severity: "error"
    then:
      function: undefined

  enforce-https:
    description: "APIs should enforce HTTPS to ensure secure communication."
    given: "$.servers[*].url"
    severity: "error"
    then:
      function: pattern
      functionOptions:
        match: "^https://"

  no-open-endpoints:
    description: "Public APIs should require authentication."
    given: "$.paths[*][get,post,put,delete].security"
    severity: "warning"
    then:
      function: defined
